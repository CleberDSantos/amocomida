<ion-header>
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Adicionar Ingrediente</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="saveIngredient()">
        <ion-icon name="checkmark"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content color="dark" class="ion-padding">
  <ion-list>
    <!-- Nome do Ingrediente -->
    <ion-item>
      <ion-label position="stacked">Nome do Ingrediente</ion-label>
      <ion-input
        type="text"
        [(ngModel)]="ingredient.name"
        placeholder="Ex: Arroz"
        required>
      </ion-input>
    </ion-item>

    <!-- Categoria com Dropdown -->
    <ion-item>
      <ion-label position="stacked">Categoria</ion-label>
      <ion-select
        [(ngModel)]="ingredient.category"
        placeholder="Selecione uma categoria"
        interface="popover">
        <ion-select-option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Unidade com Dropdown -->
    <ion-item>
      <ion-label position="stacked">Unidade</ion-label>
      <ion-select
        [(ngModel)]="ingredient.unit"
        (ionChange)="selectUnit(ingredient.unit)"
        placeholder="Selecione uma unidade"
        interface="popover">
        <ion-select-option *ngFor="let unit of units" [value]="unit">
          {{ unit }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Quantidade: campo numérico -->
    <ion-item>
      <ion-label position="stacked">Quantidade</ion-label>
      <ion-input
        type="number"
        inputmode="decimal"
        min="0"
        step="0.01"
        [(ngModel)]="ingredient.quantity"
        (ionInput)="onQuantityInput($event)"
        placeholder="0.00">
      </ion-input>
      <ion-note slot="end">{{ ingredient.unit }}</ion-note>
    </ion-item>

    <!-- Quantidade Mínima (ion-range com default 15%) -->
    <ion-item lines="none">
      <ion-label position="stacked">Quantidade Mínima</ion-label>
      <ion-range
        [min]="0"
        [max]="ingredient.unit ? (ingredient.unit === 'kg' || ingredient.unit === 'L' ? ingredient.quantity * 1000 : ingredient.quantity) : 0"
        [step]="1"
        [snaps]="true"
        [value]="ingredient.minQuantity"
        (ionChange)="onMinQuantityChange($event)">
        <ion-label slot="start">0</ion-label>
        <ion-label slot="end">{{ ingredient.minQuantity }} {{ minQuantityUnit }}</ion-label>
      </ion-range>
    </ion-item>

    <!-- Custo Unitário -->
    <ion-item>
      <ion-label position="stacked">Custo Unitário (R$)</ion-label>
      <ion-input
        type="number"
        [(ngModel)]="ingredient.cost"
        placeholder="0.00"
        step="0.01">
      </ion-input>
    </ion-item>
  </ion-list>

  <!-- Botão de salvar -->
  <ion-button
    expand="block"
    (click)="saveIngredient()"
    [disabled]="!ingredient.name || !ingredient.category || !ingredient.unit || ingredient.minQuantity <= 0">
    Salvar Ingrediente
  </ion-button>
</ion-content>
