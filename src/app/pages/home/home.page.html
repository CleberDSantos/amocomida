<ion-header class="ion-no-border">
  <ion-toolbar color="dark">
    <ion-title>
      <div class="header-content">
        <span class="app-name">AmoComida</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear">
        <ion-icon name="notifications-outline" color="medium"></ion-icon>
        <ion-badge color="danger" class="notification-badge">3</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">

  <!-- Search Bar -->
  <div class="search-section">
    <ion-searchbar
      [(ngModel)]="searchTerm"
      placeholder="Buscar receitas, ingredientes..."
      debounce="500"
      (ionInput)="onSearch($event)"
      class="custom-searchbar"
      mode="ios">
    </ion-searchbar>
    <ion-button fill="clear" class="filter-btn">
      <ion-icon name="filter-outline" color="light"></ion-icon>
    </ion-button>
  </div>

  <div class="view-selector">
    <ion-segment [(ngModel)]="homeView" (ionChange)="onViewChange($event)" mode="ios">
      <ion-segment-button value="feed">
        <ion-label>Feed</ion-label>
      </ion-segment-button>
      <ion-segment-button value="discover">
        <ion-label>Descobrir</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" pull-factor="0.5">
    <ion-refresher-content
      pulling-text="Puxe para atualizar..."
      refreshing-text="Atualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <!-- Skeleton Cards -->
    <div class="skeleton-recipes">
      <app-skeleton-loader isCard="true" *ngFor="let i of [1,2,3,4,6,7,8]"></app-skeleton-loader>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">

    <!-- Special Offers / Destaques Section -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">Destaques</h2>
        <a class="see-all">Ver Todos</a>
      </div>

      <div class="offers-carousel">
        <div class="offer-card" *ngFor="let featured of featuredRecipes">
          <div class="offer-content">
            <div class="offer-text">
              <h3 class="offer-title">{{ featured.name }}</h3>
              <p class="offer-description">{{ featured.description }}</p>
              <div class="offer-meta">
                <span class="prep-time">
                  <ion-icon name="time-outline"></ion-icon>
                  {{ featured.prepTime || 30 }} min
                </span>
              </div>
              <button class="order-btn" [routerLink]="['/recipe-detail', featured.id]">
                VER RECEITA
              </button>
            </div>
            <div class="offer-image">
              <img [src]="featured.image || 'assets/default-food.jpg'" [alt]="featured.name">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Categories Section -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">Categorias</h2>
        <a class="see-all" routerLink="/categories">Ver Todas</a>
      </div>

      <div class="categories-container">
        <div class="category-card" *ngFor="let category of categories" (click)="selectCategory(category)">
          <div class="category-icon-wrapper" [style.background]="getCategoryBackground(category.type)">
            <ion-icon [name]="category.icon" class="category-icon"></ion-icon>
          </div>
          <span class="category-name">{{ category.name }}</span>
        </div>
      </div>
    </div>

    <!-- Featured Products / Top Recipes Section -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">Receitas Mais Votadas</h2>
        <a class="see-all">Ver Todas</a>
      </div>

      <div class="products-grid">
        <div class="product-card" *ngFor="let recipe of topRecipes; trackBy: trackByRecipe"
             [routerLink]="['/recipe-detail', recipe.id]">
          <div class="product-image-container">
            <img [src]="recipe.image || 'assets/default-food.jpg'" [alt]="recipe.name" class="product-image">
            <div class="rating-badge">
              <ion-icon name="star"></ion-icon>
              <span>{{ recipe.rating || 4.5 }}</span>
            </div>
            <button class="favorite-btn" (click)="toggleFavorite(recipe, $event)">
              <ion-icon [name]="recipe.favorited ? 'heart' : 'heart-outline'"
                       [color]="recipe.favorited ? 'danger' : ''"></ion-icon>
            </button>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ recipe.name }}</h3>
            <p class="product-description">{{ recipe.description }}</p>
            <div class="product-footer">
              <span class="product-price">R$ {{ calculateCost(recipe) }}</span>
              <span class="product-time">
                <ion-icon name="time-outline"></ion-icon>
                {{ recipe.prepTime || 30 }} min
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="showEmptyState" class="empty-state">
      <ion-icon name="restaurant-outline" size="large" color="medium"></ion-icon>
      <h2>Nenhuma receita encontrada</h2>
      <p>Comece criando sua primeira receita!</p>
      <ion-button fill="outline" routerLink="/add-recipe">
        <ion-icon name="add" slot="start"></ion-icon>
        Criar Receita
      </ion-button>
    </div>

  </div>

  <!-- FAB for Quick Add -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" size="small">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>
